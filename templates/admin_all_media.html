{% extends "base.html" %} {% set show_notifications = false %} {% block title
%}All Media | Admin{% endblock %} {% block content %}
<div class="all-media-page">
  <div class="container">
    <h1>All Uploaded Media</h1>
    <p class="subtitle">Manage and moderate all media uploaded by users</p>

    <div class="media-grid" id="mediaGrid"></div>
  </div>
</div>

<script>
  const mediaGrid = document.getElementById("mediaGrid");

  function fetchAllMedia() {
    fetch("/admin/media/data")
      .then((res) => res.json())
      .then((data) => renderMedia(data));
  }

  function renderMedia(mediaList) {
    mediaGrid.innerHTML = "";

    if (mediaList.length === 0) {
      mediaGrid.innerHTML = `
      <div class="empty-state">
        <i class="fa-regular fa-folder-open"></i>
        <p>No media uploaded yet</p>
      </div>`;
      return;
    }

    mediaList.forEach((media) => {
      let preview = "";

      if (media.type === "image") {
        preview = `<img src="${media.file_url}" alt="Image" />`;
      } else if (media.type === "audio") {
        preview = `
        <audio controls style="width: 100%">
          <source src="${media.file_url}">
          Your browser does not support audio playback.
        </audio>`;
      } else if (media.type === "video") {
        preview = `
        <video controls width="100%" height="180">
          <source src="${media.file_url}">
          Your browser does not support video playback.
        </video>`;
      }

      mediaGrid.innerHTML += `
      <div class="media-card">
        <div class="card-thumb">${preview}</div>

        <div class="card-body">
          <div class="media-title">
            <span>${media.title}</span>
            <i class="fa-solid ${
              media.type === "audio"
                ? "fa-music"
                : media.type === "image"
                  ? "fa-image"
                  : "fa-video"
            } media-type-icon"></i>
          </div>

          <div class="media-meta">
            <span><i class="fa-regular fa-calendar"></i> ${media.date_uploaded}</span>
            <span><i class="fa-solid fa-file"></i> ${media.size} MB</span>
          </div>
        </div>

        <div class="card-footer">
          <div class="card-actions-right">
            <i class="fa-solid fa-trash action-icon delete-btn"
               onclick="deleteMedia(${media.id})"></i>
          </div>
        </div>
      </div>
    `;
    });
  }

  function deleteMedia(mediaId) {
    if (!confirm("Are you sure you want to delete this media?")) return;

    fetch(`/admin/delete-media/${mediaId}`, { method: "DELETE" })
      .then((res) => res.json())
      .then((data) => {
        alert(data.message);
        fetchAllMedia();
      });
  }
  fetchAllMedia();
</script>
{% endblock %}
